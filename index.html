<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Focus Pet</title>

<link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap" rel="stylesheet" />
<script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  margin:0;
  font-family:'Fredoka',sans-serif;
  background:linear-gradient(160deg,#042b28,#0b4340,#13565a);
  color:#e8fbf6;
  display:flex;
  flex-direction:column;
  align-items:center;
  min-height:100vh;
}
header{
  width:100%;
  display:flex;
  justify-content:space-around;
  padding:10px;
}
.card{background:rgba(255,255,255,0.05);padding:10px 20px;border-radius:12px;text-align:center;}
main{display:flex;flex-direction:column;align-items:center;margin-top:20px}
#petBox{
  width:220px;height:220px;
  border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  background:rgba(255,255,255,0.05);
  box-shadow:0 0 20px rgba(0,0,0,0.4);
  margin-bottom:20px;
}
lottie-player{width:180px;height:180px}
#time{font-size:2.5em;margin:10px 0}
button{
  font-family:'Fredoka',sans-serif;
  background:#8de0c7;
  border:none;
  color:#043;
  font-weight:700;
  border-radius:10px;
  padding:10px 20px;
  margin:5px;
  cursor:pointer;
}
#shop,#progress{display:none;text-align:center;margin-top:30px}
.shop-item{
  background:rgba(255,255,255,0.05);
  padding:12px;border-radius:12px;margin:8px;
  display:inline-block;width:150px;
}
.tab-bar{margin:10px}
.tab{background:none;border:1px solid rgba(255,255,255,0.2);color:#e8fbf6;padding:6px 12px;border-radius:8px;cursor:pointer}
.tab.active{background:#8de0c7;color:#043;font-weight:700}
canvas{margin-top:10px}
nav{position:fixed;bottom:15px;background:rgba(0,0,0,0.4);padding:8px 16px;border-radius:30px}
nav button{background:none;border:none;color:#fff;margin:0 10px;font-size:1em;cursor:pointer}
nav button.active{color:#8de0c7;font-weight:700}
</style>
</head>
<body>

<header>
  <div class="card">Usage Time<br><span id="usageTotal">0 m</span></div>
  <div class="card">Focus Today<br><span id="todayTotal">0 m</span></div>
  <div class="card">Coins<br><span id="coins">0</span></div>
</header>

<main id="home">
  <div id="petBox">
    <lottie-player id="pet" src="Cat Pookie.json" background="transparent" speed="1" loop autoplay></lottie-player>
  </div>
  <div id="status">Your pet is sleepy‚Ä¶</div>
  <div id="time">00:00</div>
  <div>
    <button id="startBtn">Start</button>
    <button id="pauseBtn">Pause</button>
    <button id="resetBtn">Reset</button>
  </div>
</main>

<section id="shop">
  <h2>Shop</h2>
  <div class="shop-item">üçñ Feed Pet (10 coins)<br><button id="feedBtn">Buy</button></div>
  <div class="shop-item">üß∏ Play Pet (15 coins)<br><button id="playBtn">Buy</button></div>
</section>

<section id="progress">
  <h2>Progress</h2>
  <div class="tab-bar">
    <button class="tab active" data-period="daily">Daily</button>
    <button class="tab" data-period="weekly">Weekly</button>
    <button class="tab" data-period="monthly">Monthly</button>
    <button class="tab" data-period="yearly">Yearly</button>
  </div>
  <canvas id="pieChart" width="250" height="200"></canvas>
  <canvas id="barChart" width="320" height="200"></canvas>
  <p>Weekly Average: <span id="weeklyAvg">0</span> min</p>
</section>

<nav>
  <button id="navHome" class="active">Home</button>
  <button id="navShop">Shop</button>
  <button id="navProgress">Progress</button>
</nav>

<script>
window.onload = () => {
  const pet=document.getElementById('pet');
  const status=document.getElementById('status');
  const timeEl=document.getElementById('time');
  const coinsEl=document.getElementById('coins');
  const usageEl=document.getElementById('usageTotal');
  const todayEl=document.getElementById('todayTotal');
  const pieCtx=document.getElementById('pieChart').getContext('2d');
  const barCtx=document.getElementById('barChart').getContext('2d');

  let seconds=0,timer=null,isRunning=false;
  let coins=parseInt(localStorage.getItem('fp_coins')||'0');
  let sessions=JSON.parse(localStorage.getItem('fp_sessions')||'[]');
  let pieChart,barChart,currentPeriod='daily';
  coinsEl.textContent=coins;

  function fmt(s){const m=Math.floor(s/60).toString().padStart(2,'0');const sec=(s%60).toString().padStart(2,'0');return `${m}:${sec}`;}
  function updateDisplay(){timeEl.textContent=fmt(seconds);}
  function updateStatus(){
    if(seconds<30){status.textContent="Your pet is sleepy‚Ä¶";pet.setSpeed(0.6);}
    else if(seconds<60){status.textContent="Your pet is waking up!";pet.setSpeed(1);}
    else{status.textContent="Your pet is excited!";pet.setSpeed(1.5);}
  }
  function startTimer(){
    if(isRunning) return;
    isRunning=true;
    timer=setInterval(()=>{
      seconds++;
      if(seconds%10===0){coins++;coinsEl.textContent=coins;}
      updateDisplay();updateStatus();
    },1000);
  }
  function pauseTimer(){
    if(!isRunning) return;
    clearInterval(timer);isRunning=false;
    const today=new Date().toISOString().split('T')[0];
    sessions.push({date:today,secs:seconds});
    localStorage.setItem('fp_sessions',JSON.stringify(sessions));
    localStorage.setItem('fp_coins',coins);
    seconds=0;updateDisplay();renderCharts();
  }
  function resetTimer(){clearInterval(timer);isRunning=false;seconds=0;updateDisplay();updateStatus();}

  document.getElementById('startBtn').onclick=startTimer;
  document.getElementById('pauseBtn').onclick=pauseTimer;
  document.getElementById('resetBtn').onclick=resetTimer;

  // Shop
  document.getElementById('feedBtn').onclick=()=>{if(coins>=10){coins-=10;coinsEl.textContent=coins;pet.setSpeed(2);status.textContent="Your pet enjoyed the meal!";setTimeout(updateStatus,3000);}else alert("Not enough coins!");};
  document.getElementById('playBtn').onclick=()=>{if(coins>=15){coins-=15;coinsEl.textContent=coins;pet.setSpeed(2.5);status.textContent="Your pet is playing happily!";setTimeout(updateStatus,3000);}else alert("Not enough coins!");};

  // Navigation
  const home=document.getElementById('home');
  const shop=document.getElementById('shop');
  const progress=document.getElementById('progress');
  function show(tab){
    [home,shop,progress].forEach(s=>s.style.display='none');
    document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
    document.getElementById('nav'+tab).classList.add('active');
    document.getElementById(tab.toLowerCase()).style.display='block';
  }
  document.getElementById('navHome').onclick=()=>show('Home');
  document.getElementById('navShop').onclick=()=>show('Shop');
  document.getElementById('navProgress').onclick=()=>{show('Progress');renderCharts();};

  // Progress charts
  function aggregate(){
    const map={};
    for(const s of sessions){map[s.date]=(map[s.date]||0)+s.secs;}
    return map;
  }
  function renderCharts(){
    const map=aggregate();
    const today=new Date();
    const weekData=[],labels=[];
    for(let i=6;i>=0;i--){
      const d=new Date(today);d.setDate(today.getDate()-i);
      const key=d.toISOString().split('T')[0];
      labels.push(d.toLocaleDateString(undefined,{weekday:'short'}));
      weekData.push(Math.round((map[key]||0)/60));
    }
    const totalWeek=weekData.reduce((a,b)=>a+b,0);
    document.getElementById('weeklyAvg').textContent=(totalWeek/7).toFixed(1);
    if(pieChart) pieChart.destroy();
    pieChart=new Chart(pieCtx,{type:'doughnut',data:{labels:['Today','Rest of Week'],datasets:[{data:[weekData[6],totalWeek-weekData[6]],backgroundColor:['#8de0c7','#3b3b3b']}]},options:{plugins:{legend:{display:false}}}});
    if(barChart) barChart.destroy();
    barChart=new Chart(barCtx,{type:'bar',data:{labels,datasets:[{data:weekData,backgroundColor:'#8de0c7'}]},options:{plugins:{legend:{display:false}},scales:{y:{beginAtZero:true,ticks:{color:'#eee'}},x:{ticks:{color:'#eee'}}}}});
  }
  renderCharts();
  updateDisplay();updateStatus();
};
</script>
</body>
</html>
